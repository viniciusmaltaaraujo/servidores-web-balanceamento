vrrp_script check_nginx_advanced {              # Define o script de health check
    script "/usr/local/bin/check_nginx_advanced.sh"   # Script que será executado
    interval 2                                       # Executa o script a cada 2 segundos
    weight 50                                        # Peso que influencia na prioridade em caso de falha
    fall 2                                           # Precisa falhar 2 vezes seguidas para ser considerado DOWN
    rise 1                                           # Basta 1 sucesso para voltar a ser considerado UP
}

vrrp_instance VI_1 {                        # Instância VRRP (mesmo nome e ID do MASTER)
    state BACKUP                            # Este nó inicia como BACKUP (só assume se o MASTER falhar)
    interface enp0s3                        # Interface de rede usada para VRRP
    virtual_router_id 51                    # ID do roteador virtual (igual ao MASTER → precisam se "enxergar")
    priority 100                            # Prioridade menor que o MASTER (100 < 101), logo ele é BACKUP
    advert_int 1                            # Intervalo dos anúncios VRRP em segundos

    authentication {                        # Autenticação para validar mensagens VRRP
        auth_type PASS                      # Tipo de autenticação (senha simples)
        auth_pass mysecretpass              # Senha (deve ser igual ao MASTER)
    }

    virtual_ipaddress {                     # IP virtual compartilhado entre MASTER e BACKUP
        192.168.15.200/24 dev enp0s3        # VIP (mesmo que o MASTER)
    }

    track_script {                          # Scripts monitorados pelo VRRP
        check_nginx_advanced                # Usa o mesmo health check para decidir se pode assumir o VIP
    }
}
